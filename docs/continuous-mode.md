# 连续模式开发任务清单

## 阶段 0：调研与规划
- 根据设计目标/非目标，明确连续模式的验收标准。
- 与利益相关方确认目标工作流，整理示例场景，用于 UX 文案与提示设计。
- 梳理开放问题（测试默认策略、协作交接、Git 快照策略），确定决策负责人与时间表。

## 阶段 1：CLI 体验落地
- 在 CLI 前端引入 `--continuous` 开关及配置项，补充帮助文档。
- 启动时展示需求摘要、自动规划任务列表和退出条件的预览界面。
- 构建交互循环，支持继续、编辑需求、终止、帮助等快捷键。
- 接入 `--max-steps`、`--confirm-on-breakpoint` 参数，并实现默认值与输入校验。

## 阶段 2：执行引擎基础
- 扩展规划管线，输出带依赖关系和推荐顺序的结构化任务列表。
- 引入任务状态机（`pending`/`active`/`blocked`/`done`），确保状态流转被记录。
- 实现核心循环：挑选下一个任务、调用现有执行器、归档每步结果。

## 阶段 3：状态持久化与恢复
- 设计轻量级持久化格式（如 `.codex/state/continuous` 下的 JSON）。
- 每轮执行后保存计划、任务状态、最近输出、环境元数据。
- 提供 `codex resume` 入口，在安全校验后恢复到上次进度。

## 阶段 4：防护与停止条件
- 侦测命令失败、依赖缺失、外部文件被改动，触发自动暂停并给出提示。
- 实现时间上限、连续无效迭代、最大步数等启发式，阻止无限循环。
- 在连续模式中遇到潜在破坏性操作或长时间测试前必须获得确认。

## 阶段 5：日志与汇总
- 按步骤在终端输出任务、命令、结果的概览，并使用清晰的配色。
- 将同样的摘要写入会话日志文件，便于事后追溯与调试。
- 当任务完成或中断时，给出终局报告及待办项目。

## 阶段 6：配置与默认值
- 扩展 `config.toml` 结构，允许为连续模式设置默认参数。
- 记录 CLI 参数、配置条目、环境变量之间的优先级规则。
- 提供默认断点、超时时间、日志路径等合理初值，并防止非法取值。
- 将连续模式设为默认执行流程，同时保留显式退出开关以兼容传统交互模式。

## 阶段 7：质量保障
- 为状态机、停止条件、序列化/反序列化添加单元测试。
- 构建模拟连续会话的集成/冒烟测试，验证暂停与恢复逻辑。
- 在默认开启前制定手动 QA 检查项（顺畅路径、防护触发、崩溃后恢复等）。

## 阶段 8：文档与发布
- 更新用户文档（CLI 手册、实验特性说明），解释用法、控制项、限制。
- 提供变更日志及迁移指引，告知如何关闭该特性以防回退。
- 收集试用反馈、监控指标，评估何时从实验阶段毕业。
